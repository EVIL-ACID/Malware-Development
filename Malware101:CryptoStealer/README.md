## What is a Crypto Stealer ? 

Crypto stealer malware is a type of malicious software that is designed to steal cryptocurrencies from the victim's wallet or account. Once installed these malwares often operate by monitoring the device for cryptocurrency-related activity. When the victim attempts to access their wallet or account in anyway, the malware captures their login credentials and sends them to the attacker.

## In this post we will be focusing on Crypto Clippers which can be classfied under the Crypto Stealers family.

Crypto clipper malwares are a type of malicious software that targets cryptocurrencies. These malwares typically operate by replacing a user's cryptocurrency address with the attacker's own address when the user attempts to make a transaction. This allows the attacker to redirect the funds from the intended recipient to their own wallet.

Crypto clipper malwares often operate by injecting/monitoring the user's clipboard, which is used to store temporary data such as text or images that have been copied. When the user attempts to paste the address of the intended recipient into the cryptocurrency wallet software, the malware replaces the address with the attacker's own address before it is pasted.

This type of malware is interesting because it is simple yet capable of causing significant damage. In some cases, malware clippers only have the ability to monitor input and alter the clipboard, which looks harmless and unlikely to raise any alarms. 

In this post I will be going over basic design and implementation details of a simple clipper malware. We will be working on a windows environment with C++. We will also be utilizing some winapi functions, the heart of this malware is all about monitoring and changing clipboard data with the winapi.


## Design requirements

##### Windows offers various functions of interest that will make our jobs easier to build this. We will be using the following functions from the winapi

- OpenClipboard() to get access to the clipboard.
- IsClipboardFormatAvailable() to examin the content of the clipboard. Keep in mind that things like emojis and images can be copied so we dont want to get whatever data there is we are only interested in text data. 
- GetClipboardData() to get the actual text data.
- CloseClipboard() and GlobalLock() to free data and unlock resources.

##### Now, using the following functions we can actually start getting the data from the clipboard, but it's useless because we don't know when the user is using the clipboard. We would also need to run an infinite loop every second hoping we capture the crypto address we want. That's bad and would actaully never work in the real world so we need to find a better solution. Thankfully, windows has a [WM_CLIPBOARDUPDATE][1] message which is sent whenever the clipboard is updated. We will need to listen to those messages using the AddClipboardFormatListener() functions.

##### Those are all the functions we will be using from the winapi except for a few cleanup functions I didn't include in the list we will discuss them later in the Implementation section. 

#### The function we will need to implement ourselves are fairly simple.

- crypto_check(CONST CHAR* address, CONST CHAR* regex_pattern) a function to check the given data against a regex pattern for a crypto address.

This should be all for the basic barebone implementation of this malware. I won't be adding any anti-reversing/vm checks or evasion techniques, I will have write ups for those topics soon. For now I'm going to try and keep this one very short.

## Implementation

Coming soon...

[1]: https://learn.microsoft.com/en-us/windows/win32/dataxchg/wm-clipboardupdate "WM_CLIPBOARDUPDATE"
